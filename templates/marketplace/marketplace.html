{% extends 'base.html' %}

{% block content %}



<!-- Header-->


<!-- Sell Product Button -->

<div class="container mt-4 mb-4 text-center">
    {% if user.is_authenticated %}
        <a href="{% url 'marketplace:add_product' %}" class="btn btn-primary">Sell Product</a>
    {% else %}
        <button class="btn btn-outline-dark mt-auto" onclick="openLoginModal()">Sell Product</button>
        <!-- Login Button (Initially Hidden) -->
        <a id="loginButton" href="{% url 'user:login' %}?next={{ request.path }}" class="btn btn-primary" style="display: none;">Please Login</a>
    {% endif %}
</div>

<!-- Marketplace Products Section -->
<section class="py-5">
    <div class="container px-4 px-lg-5 mt-5">
        <div class="row gx-4 gx-lg-5 row-cols-2 row-cols-md-3 row-cols-xl-4 justify-content-center">
            {% for product in products %}
                <div class="col mb-5">
                    <div class="card h-100 shadow-sm">
                        <!-- Product image-->
                        <a href="{% url 'marketplace:product' product.pk %}">
                            <img class="card-img-top" src="{{ product.image.url }}" alt="{{ product.name }}" />
                        </a>
                        <!-- Product details-->
                        <div class="card-body p-4">
                            <!-- Product name-->
                            <a href="{% url 'marketplace:product' product.pk %}" class="text-decoration-none text-dark">
                                <h5 class="card-title fw-bolder">{{ product.name }}</h5>
                            </a>
                            <!-- Product price-->
                            <p class="card-text">
                                {% if product.is_sale %}
                                    <span class="text-muted"><strike>€{{ product.price }}</strike></span>
                                    <span class="text-danger ms-2">€{{ product.sale_price }}</span>
                                    <span class="badge bg-danger text-white ms-2">Sale</span>
                                {% else %}
                                    €{{ product.price }}
                                {% endif %}
                            </p>
                            <!-- Product category-->
                            <p class="card-text small text-muted">Category: {{ product.category }}</p>
                        </div>
                        <!-- Product actions-->
                        <div class="card-footer p-4 pt-0 border-top-0 bg-transparent">
                            <div class="d-grid">
                                <a class="btn btn-outline-dark mt-auto" href="{% url 'marketplace:product' product.pk %}">View Product</a>
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
</section>

<!-- Login Modal -->
<div id="loginModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeLoginModal()">&times;</span>
        <p>Please log in to sell your product.</p>
    </div>
</div>

<script>
    function openLoginModal() {
        var modal = document.getElementById("loginModal");
        modal.style.display = "block";
    }

    function closeLoginModal() {
        var modal = document.getElementById("loginModal");
        modal.style.display = "none";
    }

    window.onclick = function(event) {
        var modal = document.getElementById("loginModal");
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }
</script>

{% endblock %}
